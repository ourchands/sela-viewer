name: ุจูุงุก Sela Viewer ุชููุงุฆูุงู

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build-linux:
    runs-on: ubuntu-22.04
    
    steps:
    - name: ๐ฅ ุชุญููู ูููุงุช ุงููุณุชูุฏุน
      uses: actions/checkout@v4
      
    - name: ๐ง ุชุซุจูุช ุงููุชุทูุจุงุช ุงูุฃุณุงุณูุฉ
      run: |
        sudo apt-get update
        sudo apt-get install -y \
          build-essential \
          cmake \
          git \
          python3 \
          python3-pip \
          wget \
          curl
        
    - name: ๐ ุชุซุจูุช ููุชุจุงุช ุงูุชุทููุฑ
      run: |
        sudo apt-get install -y \
          libgl1-mesa-dev \
          libglu1-mesa-dev \
          libx11-dev \
          libxinerama-dev \
          libxrandr-dev \
          libxi-dev \
          libxcursor-dev \
          libfreetype6-dev \
          libfontconfig1-dev \
          libasound2-dev \
          libpulse-dev \
          libssl-dev \
          libboost-all-dev
        
    - name: ๐ ุชุซุจูุช ููุชุจุงุช ุฏุนู ุงููุบุฉ ุงูุนุฑุจูุฉ
      run: |
        sudo apt-get install -y \
          libharfbuzz-dev \
          libfribidi-dev \
          libicu-dev
        
    - name: ๐ฆ ุงุณุชูุณุงุฎ Firestorm Viewer
      run: |
        git clone --depth 1 https://github.com/FirestormViewer/phoenix-firestorm.git firestorm
        cd firestorm
        LATEST_TAG=$(git describe --tags --abbrev=0 2>/dev/null || echo "main")
        echo "ุงุณุชุฎุฏุงู ุงูุฅุตุฏุงุฑ: $LATEST_TAG"
        
    - name: ๐ค ุฅุถุงูุฉ ูููุงุช ุฏุนู ุงููุบุฉ ุงูุนุฑุจูุฉ
      run: |
        # ูุณุฎ ูููุงุช ุฏุนู ุงูุนุฑุจูุฉ
        mkdir -p firestorm/indra/llui
        cp llarabicsupport.h firestorm/indra/llui/ || echo "ุชุญุฐูุฑ: ูู ูุชู ูุณุฎ llarabicsupport.h"
        cp llarabicsupport.cpp firestorm/indra/llui/ || echo "ุชุญุฐูุฑ: ูู ูุชู ูุณุฎ llarabicsupport.cpp"
        
        # ูุณุฎ ููู CMake
        mkdir -p firestorm/indra/cmake
        cp Arabic.cmake firestorm/indra/cmake/ || echo "ุชุญุฐูุฑ: ูู ูุชู ูุณุฎ Arabic.cmake"
        
        echo "โ ุชู ูุณุฎ ูููุงุช ุฏุนู ุงูุนุฑุจูุฉ"
        
    - name: ๐๏ธ ุชุญููู ุงูุฎุท ุงูุนุฑุจู
      run: |
        mkdir -p firestorm/indra/newview/skins/default/fonts
        wget -q -O firestorm/indra/newview/skins/default/fonts/NotoSansArabic-Regular.ttf \
          "https://github.com/googlefonts/noto-fonts/raw/main/hinted/ttf/NotoSansArabic/NotoSansArabic-Regular.ttf"
        echo "โ ุชู ุชุญููู ุงูุฎุท ุงูุนุฑุจู"
        
    - name: โ๏ธ ุชุนุฏูู ูููุงุช ุงูุจูุงุก
      run: |
        cd firestorm
        
        # ุชุนุฏูู CMakeLists.txt ูุฅุถุงูุฉ ุฏุนู ุงูุนุฑุจูุฉ
        if [ -f "indra/llui/CMakeLists.txt" ]; then
          # ุฅุถุงูุฉ include ููุนุฑุจูุฉ
          if ! grep -q "include(Arabic)" indra/llui/CMakeLists.txt; then
            sed -i '1i include(Arabic)' indra/llui/CMakeLists.txt
          fi
          
          # ุฅุถุงูุฉ ูููุงุช ุงููุตุฏุฑ
          if ! grep -q "llarabicsupport.cpp" indra/llui/CMakeLists.txt; then
            sed -i '/set(llui_SOURCE_FILES/a \    llarabicsupport.cpp' indra/llui/CMakeLists.txt
          fi
          
          if ! grep -q "llarabicsupport.h" indra/llui/CMakeLists.txt; then
            sed -i '/set(llui_HEADER_FILES/a \    llarabicsupport.h' indra/llui/CMakeLists.txt
          fi
          
          echo "โ ุชู ุชุนุฏูู ูููุงุช ุงูุจูุงุก"
        fi
        
    - name: ๐๏ธ ุชููุฆุฉ ุงูุจูุงุก
      run: |
        cd firestorm
        ./autobuild configure -c ReleaseOS -- \
          -DVIEWER_CHANNEL="Sela Viewer" \
          -DVIEWER_SHORT_NAME="Sela" \
          -DSTANDALONE:BOOL=ON
        
    - name: ๐จ ุจูุงุก Sela Viewer
      run: |
        cd firestorm
        echo "โฐ ุจุฏุก ุงูุจูุงุก - ูุฏ ูุณุชุบุฑู 1-2 ุณุงุนุฉ..."
        ./autobuild build -c ReleaseOS -- -j2
        echo "โ ุงูุชูู ุงูุจูุงุก ุจูุฌุงุญ!"
        
    - name: ๐ฆ ุฅูุดุงุก ุงูุญุฒูุฉ
      run: |
        cd firestorm
        ./autobuild package -c ReleaseOS || echo "ุชุญุฐูุฑ: ูุดู ุฅูุดุงุก ุงูุญุฒูุฉ"
        
    - name: ๐ค ุฑูุน ุงูุจุฑูุงูุฌ ุงูุฌุงูุฒ
      uses: actions/upload-artifact@v4
      with:
        name: Sela-Viewer-Linux-x64
        path: |
          firestorm/build-linux-x86_64/newview/packaged/*
          !firestorm/build-linux-x86_64/newview/packaged/*.tar.*
        retention-days: 30
        if-no-files-found: warn
```

#### ุงูุฎุทูุฉ 4: ุญูุธ ุงูููู
1. ุงูุฒู ููุฃุณูู
2. ูู ูุฑุจุน "Commit message" ุงูุชุจ:
```
   ุฅุถุงูุฉ ุงูุจูุงุก ุงูุชููุงุฆู ูู Sela Viewer
```
3. ุงุถุบุท ุงูุฒุฑ ุงูุฃุฎุถุฑ **"Commit changes"**

---

## โ๏ธ ุชุดุบูู ุงูุจูุงุก ุงูุชููุงุฆู:

ุจุนุฏ ุญูุธ ุงููููุ ุงุชุจุน ูุฐู ุงูุฎุทูุงุช:

### 1๏ธโฃ ุงุฐูุจ ุฅูู ุชุจููุจ Actions
ูู ุฃุนูู ุตูุญุฉ ุงููุณุชูุฏุนุ ุงุถุบุท ุนูู **"Actions"**

### 2๏ธโฃ ุณุชุฌุฏ Workflow ุฌุฏูุฏ
ุงุณูู: **"ุจูุงุก Sela Viewer ุชููุงุฆูุงู"**

### 3๏ธโฃ ุดุบูู ุงูุจูุงุก
1. ุงุถุบุท ุนูู ุงุณู ุงูู workflow
2. ุนูู ุงูููููุ ุงุถุบุท **"Run workflow"**
3. ูู ุงููุงุฆูุฉ ุงูููุณุฏูุฉุ ุชุฃูุฏ ูู ุงุฎุชูุงุฑ **"Branch: main"** (ุฃู master)
4. ุงุถุบุท ุงูุฒุฑ ุงูุฃุฎุถุฑ **"Run workflow"**

### 4๏ธโฃ ุชุงุจุน ุงูุชูุฏู
- ุณุชุฑู ุฏุงุฆุฑุฉ ุตูุฑุงุก ๐ก = ุฌุงุฑู ุงูุจูุงุก
- ุงูุชุธุฑ 1-2 ุณุงุนุฉ โฐ
- ุนูุฏ ุงูุงูุชูุงุก:
  - โ ุนูุงูุฉ ุฎุถุฑุงุก = ูุฌุญ!
  - โ ุนูุงูุฉ ุญูุฑุงุก = ูุดู

---

## ๐ฅ ุชุญููู ุงูุจุฑูุงูุฌ ุงูุฌุงูุฒ:

ุนูุฏูุง ููุชูู ุงูุจูุงุก ุจูุฌุงุญ (โ ุฃุฎุถุฑ):

1. ุงุถุบุท ุนูู ุงุณู ุงูุจูุงุก ุงููุงุฌุญ
2. ุงูุฒู ููุฃุณูู ุญุชู ุชุฑู **"Artifacts"**
3. ุณุชุฌุฏ: **"Sela-Viewer-Linux-x64"**
4. ุงุถุบุท ุนููู ููุชุญููู (ููู ZIP)
5. ูู ุงูุถุบุท ุนูู ุฌูุงุฒู
6. ุดุบูู ุงูุจุฑูุงูุฌ!

---

## ๐ ููุฎุต ุงูุฎุทูุงุช:
```
โ 1. ุฑูุนุช ุงููููุงุช (ุฃูููุช!)
โ 2. ุฃูุดุฆ ููู .github/workflows/build.yml
โ 3. ุงูุณุฎ ุงูููุฏ ุฃุนูุงู
โ 4. ุงุญูุธ ุงูููู
โ 5. ุงุฐูุจ ูู Actions
โ 6. ุดุบูู "Run workflow"
โ 7. ุงูุชุธุฑ 1-2 ุณุงุนุฉ โ
โ 8. ุญููู ุงูุจุฑูุงูุฌ ุงูุฌุงูุฒ
โ 9. ุงุณุชูุชุน! ๐
